<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PHOTONOIR - 2026</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Manrope:wght@300;400;600;800&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    <style>
        :root { --bg-color: #E0E0E0; --ink-color: #000; --accent-color: #960018; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        html, body {
            margin: 0; padding: 0;
            background-color: var(--bg-color); color: var(--ink-color);
            font-family: 'Manrope', sans-serif;
            display: block; min-height: 100vh; overflow-x: hidden; overflow-y: auto; scroll-behavior: smooth;
            transition: filter 0.5s ease; /* Hi·ªáu ·ª©ng chuy·ªÉn m√†u m∆∞·ª£t */
        }

        /* --- SECRET MODE (INVERT COLORS) --- */
        body.invert-mode {
            filter: invert(1) hue-rotate(180deg);
            background-color: #1f1f1f; /* ƒê·∫£o c·ªßa E0E0E0 */
        }
        /* Gi·ªØ ·∫£nh ƒëƒ©a than kh√¥ng b·ªã ƒë·∫£o m√†u n·∫øu mu·ªën (t√πy ch·ªçn), ·ªü ƒë√¢y t√¥i ƒë·ªÉ ƒë·∫£o lu√¥n cho ·∫£o */
        
        /* UTILS */
        #preloader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #E0E0E0; z-index: 9999; display: flex; justify-content: center; align-items: center; transition: opacity 0.5s; }
        .loader-text { font-family: 'Manrope', sans-serif; font-weight: 800; font-size: 18px; letter-spacing: 4px; color: var(--ink-color); animation: breathe 1s infinite; }
        #toast { visibility: hidden; min-width: 250px; background-color: #111; color: #fff; text-align: center; border-radius: 4px; padding: 12px 20px; position: fixed; z-index: 3000; left: 50%; bottom: 30px; transform: translateX(-50%); font-size: 13px; font-family: 'Manrope', sans-serif; letter-spacing: 1px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }

        /* OVERLAY CHUNG (D√πng cho c·∫£ Voucher v√† Share) */
        .overlay-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 2000;
            flex-direction: column; justify-content: center; align-items: center;
            backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
            animation: fadeIn 0.5s ease;
            overflow-y: auto; padding: 20px 0;
        }
        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }

        /* --- VOUCHER TICKET STYLE --- */
        #voucher-ticket {
            background: #F8F8F8; width: 320px; color: #111; flex-shrink: 0;
            font-family: 'Manrope', sans-serif; box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            position: relative; 
            background-image: radial-gradient(circle at bottom, transparent 6px, #F8F8F8 6.5px);
            background-size: 20px 20px; background-position: bottom center; background-repeat: repeat-x;
            padding-bottom: 20px; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2));
        }
        .ticket-header { background: #fff; color: #000; padding: 25px 20px 15px; text-align: center; border-bottom: 2px dashed #ddd; }
        .ticket-brand { font-family: 'Playfair Display', serif; font-weight: 700; font-size: 22px; letter-spacing: 2px; text-transform: uppercase; }
        .ticket-sub { font-size: 10px; text-transform: uppercase; letter-spacing: 4px; margin-top: 5px; color: #666; }
        .ticket-body { padding: 30px 25px; text-align: center; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .ticket-label { font-size: 11px; text-transform: uppercase; letter-spacing: 2px; color: #555; font-weight: 600; }
        .ticket-value { font-size: 56px; font-weight: 800; color: var(--accent-color); line-height: 1; letter-spacing: -2px; }
        .ticket-value.used { color: #aaa; font-size: 32px; letter-spacing: 0; text-decoration: line-through; border: 2px solid #aaa; padding: 5px 15px; transform: rotate(-5deg); }
        .barcode { width: 80%; height: 35px; margin: 15px auto; background: repeating-linear-gradient(90deg, #222 0px, #222 2px, transparent 2px, transparent 5px, #222 5px, #222 8px, transparent 8px, transparent 10px); }
        .ticket-meta { width: 100%; margin-top: 15px; border-top: 1px solid #ddd; padding-top: 15px; display: flex; justify-content: space-between; align-items: center; }
        .meta-item { text-align: left; }
        .meta-label { font-size: 8px; text-transform: uppercase; color: #999; letter-spacing: 1px; margin-bottom: 2px;}
        .meta-value { font-size: 14px; font-weight: 700; font-family: monospace; color: #000; letter-spacing: 1px; }

        /* --- SHARE CARD STYLE (NEW & REALISTIC VINYL) --- */
        #share-card-container {
            width: 340px; background: #F4F4F4; padding: 40px 25px; 
            display: flex; flex-direction: column; align-items: center; 
            text-align: center; font-family: 'Manrope', sans-serif; color: #111; 
            border: 12px solid #fff; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            box-sizing: border-box; flex-shrink: 0;
        }
        .share-brand { font-family: 'Playfair Display', serif; font-weight: 700; font-size: 18px; letter-spacing: 4px; margin-bottom: 25px; opacity: 0.8; }
        
        /* Realistic Vinyl CSS */
        .real-vinyl {
            width: 180px; height: 180px; border-radius: 50%;
            background: #111;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            display: flex; justify-content: center; align-items: center;
            margin-bottom: 25px;
            /* R√£nh ƒëƒ©a */
            background-image: repeating-radial-gradient( #111 0, #111 2px, #222 3px, #111 4px );
        }
        /* √Ånh s√°ng ph·∫£n chi·∫øu tr√™n ƒëƒ©a */
        .real-vinyl::after {
            content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 50%;
            background: linear-gradient(135deg, transparent 40%, rgba(255,255,255,0.1) 50%, transparent 60%);
            pointer-events: none;
        }
        /* Nh√£n ƒëƒ©a */
        .real-label {
            width: 40%; height: 40%; border-radius: 50%;
            background-color: #eee; /* Dynamic Color */
            border: 1px solid rgba(255,255,255,0.2);
            position: relative; z-index: 2;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.3);
        }
        /* L·ªó gi·ªØa */
        .real-label::after {
            content: ""; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 6px; height: 6px; background: #f4f4f4; border-radius: 50%;
        }

        .share-song { font-size: 20px; font-weight: 800; text-transform: uppercase; line-height: 1.2; margin-bottom: 15px; color: var(--accent-color); }
        .share-analysis { font-size: 11px; line-height: 1.5; color: #555; margin-bottom: 20px; padding: 0 10px; font-weight: 500; min-height: 60px; display: flex; align-items: center; justify-content: center; }
        .share-quote { font-family: 'Playfair Display', serif; font-size: 16px; font-style: italic; line-height: 1.4; color: #222; margin-bottom: 25px; font-weight: 700; border-top: 1px solid #ddd; border-bottom: 1px solid #ddd; padding: 15px 0; width: 100%; }
        
        .share-signature-display {
            font-family: 'Dancing Script', cursive; font-size: 32px; color: #000; 
            margin-bottom: 10px; min-height: 40px;
        }
        
        .share-footer { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-top: 10px; opacity: 0.6; }
        .share-year { font-weight: 800; font-size: 12px; }
        .share-link { font-size: 9px; text-transform: uppercase; letter-spacing: 1px; }

        /* INPUT GROUP & BUTTONS */
        .modal-actions { margin-top: 20px; display: flex; flex-direction: column; gap: 10px; width: 320px; }
        .input-group { width: 100%; margin-bottom: 5px; }
        .nice-input { 
            width: 100%; padding: 12px; background: rgba(255,255,255,0.9); border: 1px solid #ccc; 
            border-radius: 4px; font-family: 'Manrope', sans-serif; font-size: 14px; text-align: center;
        }
        
        .btn-action { border: none; padding: 14px; font-family: 'Manrope', sans-serif; font-weight: 700; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; cursor: pointer; transition: all 0.2s; display: flex; justify-content: center; align-items: center; gap: 8px; border-radius: 4px; }
        .btn-save { background: rgba(255,255,255,0.15); color: #fff; border: 1px solid rgba(255,255,255,0.4); backdrop-filter: blur(5px); }
        .btn-save:active { background: #fff; color: #000; }
        .btn-share { background: #fff; color: #000; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .btn-staff { background: var(--accent-color); color: #fff; box-shadow: 0 4px 15px rgba(150, 0, 24, 0.3); }
        .btn-staff.disabled { background: #444; color: #888; pointer-events: none; }
        
        .close-text { margin-top: 10px; color: rgba(255,255,255,0.6); font-size: 12px; cursor: pointer; text-decoration: underline; text-align: center; margin-bottom: 20px; }

        /* MAIN UI ELEMENTS */
        .screen-hero { width: 100%; max-width: 480px; min-height: 100dvh; margin: 0 auto; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; z-index: 2; padding: 20px; }
        .header-group { width: 100%; display: flex; flex-direction: column; align-items: center; margin-bottom: 25px; z-index: 10; }
        .logo-img { width: 60%; max-width: 280px; height: auto; object-fit: contain; filter: contrast(1.3) drop-shadow(0 5px 10px rgba(0,0,0,0.15)); margin-bottom: 10px; cursor: pointer; }
        .logo-img:active { transform: scale(0.95); }
        .countdown-timer { font-family: 'Manrope', sans-serif; font-size: 32px; font-weight: 800; color: var(--accent-color); letter-spacing: 2px; margin-bottom: 5px; line-height: 1; font-variant-numeric: tabular-nums; text-shadow: 0 2px 0 rgba(255,255,255,0.5); }
        .sub-logo-text { font-family: 'Manrope', sans-serif; font-weight: 800; font-size: 36px; line-height: 1; color: var(--accent-color); text-transform: none; letter-spacing: -1px; margin: 0; text-align: center; text-shadow: 0 1px 0 rgba(255,255,255,0.5); transition: all 0.5s ease; }
        .center-content { display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; position: relative; z-index: 5; margin-bottom: 20px; }
        .vinyl-container { position: relative; width: 60vmin; height: 60vmin; max-width: 300px; max-height: 300px; display: flex; justify-content: center; align-items: center; transition: transform 0.1s; margin-bottom: 20px; }
        .vinyl-record { width: 100%; height: 100%; border-radius: 50%; background-color: #101010; box-shadow: 0 15px 40px rgba(0,0,0,0.5); background: repeating-radial-gradient(#050505 0, #050505 2px, #333 3px, #050505 4px); position: relative; }
        .vinyl-record::after { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; border-radius: 50%; background: linear-gradient(135deg, rgba(255,255,255,0) 30%, rgba(255,255,255,0.1) 50%, rgba(255,255,255,0) 70%); pointer-events: none; }
        .spinning-anim { animation: spin 8s linear infinite !important; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .vinyl-label { position: absolute; top: 34%; left: 34%; width: 32%; height: 32%; background-color: #f0f0f0; border-radius: 50%; display: flex; justify-content: center; align-items: center; border: 1px solid #aaa; z-index: 5; box-shadow: inset 0 0 10px rgba(0,0,0,0.1); transition: background-color 0.5s ease; }
        .spindle { width: 8px; height: 8px; background: #000; border-radius: 50%; position: absolute; z-index: 10; }
        .message-area { width: 100%; text-align: center; padding: 0 10px; display: flex; flex-direction: column; gap: 5px; height: 80px; justify-content: center; flex-shrink: 0; }
        .wishes-text { font-size: 15px; font-weight: 800; line-height: 1.35; color: var(--accent-color); text-transform: uppercase; letter-spacing: 0px; transition: opacity 0.3s; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; text-shadow: 0 1px 1px rgba(255,255,255,0.2); }
        .meta-text { font-size: 10px; color: #555; letter-spacing: 2px; font-weight: 700; text-transform: uppercase; opacity: 0.7; }
        .breathing { animation: breathe 3s ease-in-out infinite; }
        @keyframes breathe { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }
        .glitch { animation: glitch-anim 0.3s both; color: var(--accent-color) !important; } 
        .player-wrapper { width: 100%; padding: 0 20px; flex-shrink: 0; margin-bottom: 30px; }
        .player-controls { width: 100%; opacity: 0; transition: opacity 0.5s; padding-bottom: 5px; }
        .has-played .player-controls { opacity: 1; }
        .progress-bar-bg { width: 100%; height: 6px; background: rgba(0,0,0,0.1); border-radius: 3px; overflow: hidden; }
        .progress-bar-fill { width: 0%; height: 100%; background: var(--accent-color); transition: width 0.1s linear; }
        .time-display { display: flex; justify-content: space-between; margin-top: 8px; font-size: 11px; font-weight: 700; color: #000; font-family: monospace; }
        .visitor-counter { font-size: 10px; color: #666; letter-spacing: 1px; text-transform: uppercase; font-weight: 700; margin-top: 12px; display: flex; gap: 5px; justify-content: center; align-items: center; }
        .scroll-hint { position: absolute; bottom: 20px; left: 0; width: 100%; text-align: center; font-size: 10px; letter-spacing: 2px; text-transform: uppercase; opacity: 0; animation: float 2s infinite; cursor: pointer; z-index: 20; transition: opacity 1s; }
        .show-scroll { opacity: 0.6 !important; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(5px); } }
        .screen-analysis { display: none; width: 100%; max-width: 480px; margin: 0 auto; position: relative; z-index: 2; padding: 60px 30px; background: #EAEAEA; animation: fadeIn 1s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .analysis-box { border: 2px solid #000; padding: 30px 20px; background: #F2F2F2; box-shadow: 8px 8px 0px rgba(0,0,0,0.1); text-align: center; }
        .analysis-label { font-family: 'Manrope', sans-serif; font-weight: 800; font-size: 10px; letter-spacing: 2px; text-transform: uppercase; color: #555; margin-bottom: 15px; border-bottom: 1px solid #ccc; padding-bottom: 10px; text-align: left; }
        .analysis-title { font-family: 'Playfair Display', serif; font-weight: 700; font-size: 22px; font-style: normal; color: var(--accent-color); margin-bottom: 20px; line-height: 1.3; text-align: left; }
        .analysis-content { font-family: 'Manrope', sans-serif; font-size: 15px; line-height: 1.7; color: #333; text-align: justify; margin-bottom: 25px; }
        .share-btn { background-color: var(--accent-color); color: white; font-family: 'Manrope', sans-serif; font-weight: 700; font-size: 12px; letter-spacing: 1px; padding: 12px 25px; border: none; cursor: pointer; text-transform: uppercase; box-shadow: 4px 4px 0px rgba(0,0,0,0.2); transition: transform 0.1s, box-shadow 0.1s; display: inline-flex; align-items: center; gap: 8px; }
        .share-btn:active { transform: translate(2px, 2px); box-shadow: 2px 2px 0px rgba(0,0,0,0.2); }
        .share-icon { width: 14px; height: 14px; fill: white; }
        
        .screen-letter { display: none; width: 100%; max-width: 480px; margin: 0 auto; position: relative; z-index: 2; padding: 80px 30px 120px; background: linear-gradient(180deg, rgba(224,224,224,0) 0%, rgba(245,245,245,0.95) 15%, #F5F5F5 100%); }
        .letter-container { border-left: 2px solid var(--accent-color); padding-left: 25px; }
        .letter-header { font-family: 'Manrope', sans-serif; font-weight: 800; font-size: 12px; letter-spacing: 3px; text-transform: uppercase; margin-bottom: 30px; color: var(--accent-color); opacity: 0.8; }
        .letter-body { font-family: 'Playfair Display', serif; font-size: 18px; line-height: 1.8; color: #111; font-weight: 400; font-style: normal; }
        .letter-body p { margin-bottom: 25px; }
        .letter-body p:first-child::first-letter { font-size: 3.5em; float: left; line-height: 0.8; margin-right: 10px; font-weight: 600; color: var(--accent-color); }
        .letter-sign { margin-top: 50px; font-family: 'Manrope', sans-serif; font-weight: 700; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; border-top: 1px solid #ccc; display: inline-block; padding-top: 10px; }
        .hny-text { display: none; font-family: 'Manrope', sans-serif; font-weight: 900; font-size: 42px; color: var(--accent-color); text-align: center; line-height: 1.1; letter-spacing: 2px; margin-bottom: 10px; text-shadow: 0 0 20px rgba(150, 0, 24, 0.5); animation: zoomIn 1s ease-out infinite alternate; }
        @keyframes zoomIn { from { transform: scale(1); } to { transform: scale(1.05); } }
        @media (max-width: 380px) or (max-height: 700px) { .logo-img { width: 80%; } .sub-logo-text { font-size: 32px; } .countdown-timer { font-size: 26px; } .vinyl-container { width: 55vmin; height: 55vmin; } .wishes-text { font-size: 14px; } }
    </style>
</head>
<body>

    <div id="preloader"><div class="loader-text">LOADING...</div></div>
    <div id="toast">Th√¥ng b√°o</div>
    <div class="film-layer"><div class="grain"></div><div class="scratches"></div></div>

    <div id="voucher-overlay" class="overlay-modal">
        <div id="voucher-ticket">
            <div class="ticket-header">
                <div class="ticket-brand">PHOTONOIR</div>
                <div class="ticket-sub">Special Frequency</div>
            </div>
            <div class="ticket-body">
                <div class="ticket-label">Voucher Gift</div>
                <div class="ticket-value" id="voucherValue">-20K</div>
                <div class="barcode"></div>
                <div class="ticket-meta">
                    <div class="meta-item">
                        <div class="meta-label">Code Verify</div>
                        <div class="meta-value" id="securityCode">...</div>
                    </div>
                    <div class="meta-item" style="text-align: right;">
                        <div class="meta-label">Time Stamp</div>
                        <div class="meta-value" id="liveClock">00:00:00</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn-action btn-save" onclick="downloadElement('voucher-ticket', 'PhotoNoir_Ticket_20K')">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                L∆∞u v√© v·ªÅ m√°y
            </button>
            <button class="btn-action btn-staff" id="staffBtn" onclick="staffConfirm()">
                Nh√¢n vi√™n x√°c nh·∫≠n
            </button>
            <div class="close-text" onclick="closeModal('voucher-overlay')">ƒê√≥ng v√† nghe nh·∫°c ti·∫øp</div>
        </div>
    </div>

    <div id="share-overlay" class="overlay-modal">
        <div id="share-card-container">
            <div class="share-brand">PHOTONOIR</div>
            <div class="real-vinyl">
                <div class="real-label" id="realShareLabel"></div>
            </div>
            <div class="share-song" id="realShareSong">SONG NAME</div>
            <div class="share-analysis" id="realShareAnalysis">Analysis...</div>
            <div class="share-quote" id="realShareQuote">"Message..."</div>
            <div class="share-signature-display" id="signatureDisplay">Guest</div>
            <div class="share-footer">
                <div class="share-year">2026</div>
                <div class="share-link">My Frequency</div>
            </div>
        </div>

        <div class="modal-actions">
            <div class="input-group">
                <input type="text" id="shareNameInput" class="nice-input" placeholder="Nh·∫≠p t√™n b·∫°n ƒë·ªÉ k√Ω..." maxlength="15" oninput="updateSignature(this.value)">
            </div>
            
            <button class="btn-action btn-save" onclick="downloadElement('share-card-container', 'PhotoNoir_MyVibe_2026')">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                L∆∞u ·∫£nh v·ªÅ m√°y
            </button>
            
            <button class="btn-action btn-share" onclick="nativeShare()">
                <svg width="16" height="16" fill="currentColor" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg>
                Chia s·∫ª Link
            </button>
            
            <div class="close-text" onclick="closeModal('share-overlay')">ƒê√≥ng</div>
        </div>
    </div>

    <div class="screen-hero">
        <div class="header-group">
            <img src="logo.png" alt="PHOTONOIR" class="logo-img" id="logoClick">
            <div id="countdown" class="countdown-timer">00:00:00:00</div>
            <div id="hny-text" class="hny-text">HAPPY<br>NEW YEAR</div>
            <h2 class="sub-logo-text" id="mainTitle">Album OF The YEAR</h2>
        </div>

        <div class="center-content">
            <div class="vinyl-container" id="vinylContainer" onclick="handleInteraction()">
                <div class="vinyl-record" id="record"></div>
                <div class="vinyl-label" id="label"><div class="spindle"></div></div>
            </div>
            <div class="message-area">
                <div class="wishes-text breathing" id="display-text">CH·∫†M ƒê·ªÇ T√åM T·∫¶N S·ªê C·ª¶A B·∫†N</div>
                <div class="meta-text" id="meta-text">2026 COLLECTION</div>
            </div>
        </div>

        <div class="player-wrapper">
            <div class="player-controls">
                <div class="progress-bar-bg"><div class="progress-bar-fill" id="progressFill"></div></div>
                <div class="time-display"><span id="currentTime">0:00</span><span id="totalTime">--:--</span></div>
            </div>
            <div class="visitor-counter"><span>TOTAL PLAYS:</span><span id="busuanzi_container_site_pv"><span id="busuanzi_value_site_pv">...</span></span></div>
        </div>
        <div class="scroll-hint" id="scrollHint" onclick="scrollToNext()">‚Üì SCROLL TO VIEW</div>
    </div>

    <div class="screen-analysis" id="analysisSection">
        <div class="analysis-box">
            <div class="analysis-label"><span>FREQUENCY REPORT</span></div>
            <div class="analysis-title" id="analysisTitle">Why this track?</div>
            <div class="analysis-content" id="analysisContent"></div>
            <button class="share-btn" onclick="openShareOverlay()">
                <svg class="share-icon" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/></svg>
                SHARE YOUR VIBE
            </button>
        </div>
    </div>

    <div class="screen-letter">
        <div class="letter-container">
            <div class="letter-header">A LETTER FROM PHOTONOIR</div>
            <div class="letter-body">
                <p>NƒÉm v·ª´a qua l√† m·ªôt th∆∞·ªõc phim d√†i v·ªõi ƒë·∫ßy ƒë·ªß nh·ªØng gam m√†u s√°ng t·ªëi. C·∫£m ∆°n b·∫°n ƒë√£ gh√© thƒÉm tr·∫°m d·ª´ng ch√¢n nh·ªè b√© n√†y, ƒë√£ ƒë·ªÉ √¢m nh·∫°c v√† nh·ªØng th∆∞·ªõc phim c·ªßa PhotoNoir len l·ªèi v√†o m·ªôt g√≥c c·∫£m x√∫c c·ªßa b·∫°n.</p>
                <p>Ch√∫ng t√¥i tin r·∫±ng, m·ªói kho·∫£nh kh·∫Øc b·∫°n d·ª´ng l·∫°i n∆°i ƒë√¢y, d√π ch·ªâ l√† v√†i gi√¢y hay tr·ªçn v·∫πn m·ªôt b·∫£n nh·∫°c, ƒë·ªÅu l√† m·ªôt s·ª± k·∫øt n·ªëi v√¥ h√¨nh nh∆∞ng ƒë·∫ßy tr√¢n qu√Ω.</p>
                <p>H√†nh tr√¨nh 2026 ƒëang m·ªü ra. Ch√∫c b·∫°n lu√¥n gi·ªØ ƒë∆∞·ª£c "t·∫ßn s·ªë" r·ª±c r·ª° nh·∫•t c·ªßa ri√™ng m√¨nh. H√£y s·ªëng nh∆∞ m·ªôt th∆∞·ªõc phim ‚Äî ƒë·∫≠m ch·∫•t, t·ª± do v√† ƒë·∫ßy ki√™u h√£nh.</p>
            </div>
            <div class="letter-sign">The PhotoNoir Team.</div>
        </div>
    </div>

    <audio id="bgMusic"></audio>

    <script>
        // --- CONFIG & DATA ---
        const tracks = [
            { id: 1, wish: "TRACK 01: KH·ªûI ƒê·∫¶U R·ª∞C R·ª† & ƒê·∫¶Y KI√äU H√ÉNH.", song: "Sunroof - Nicky Youre", file: "track1.mp3", color: "#FFD700", analysis: "V≈© tr·ª• g·ª≠i t√≠n hi·ªáu n√†y v√¨ b·∫°n ƒë√£ s·∫µn s√†ng ƒë·ªÉ 'm·ªü n√≥c' t√¢m h·ªìn m√¨nh. NƒÉm 2026 kh√¥ng ph·∫£i l√∫c ƒë·ªÉ tr·ªën trong b√≥ng t·ªëi. S·ª± l·∫°c quan v√† nƒÉng l∆∞·ª£ng c·ªßa b·∫°n s·∫Ω l√† nam ch√¢m thu h√∫t nh·ªØng c∆° h·ªôi b·∫•t ng·ªù." },
            { id: 2, wish: "TRACK 02: S·ªêNG TR·ªåN T·ª™NG KHO·∫¢NH KH·∫ÆC ƒêI·ªÜN ·∫¢NH.", song: "Golden Hour - JVKE", file: "track2.mp3", color: "#FFA500", analysis: "C√≥ v·∫ª nh∆∞ b·∫°n ƒëang t√¨m ki·∫øm v·∫ª ƒë·∫πp trong nh·ªØng ƒëi·ªÅu b√¨nh d·ªã. B·∫£n nh·∫°c n√†y ch·ªçn b·∫°n ƒë·ªÉ nh·∫Øc nh·ªü: B·∫°n ch√≠nh l√† nh√¢n v·∫≠t ch√≠nh (Main Character) trong th∆∞·ªõc phim ƒë·ªùi m√¨nh. H√£y t·ªèa s√°ng, ngay c·∫£ khi kh√¥ng c√≥ √°nh ƒë√®n s√¢n kh·∫•u." },
            { id: 3, wish: "TRACK 03: OUT N√âT N·ªñI BU·ªíN, L·∫§Y N√âT NI·ªÄM VUI.", song: "Shake It Off - Taylor Swift", file: "track3.mp3", color: "#FF69B4", analysis: "M·ªôt ch√∫t r·∫Øc r·ªëi nƒÉm c≈© ∆∞? Qu√™n n√≥ ƒëi! T·∫ßn s·ªë n√†y xu·∫•t hi·ªán ƒë·ªÉ ti·∫øp th√™m s·ª©c m·∫°nh cho b·∫°n r≈© b·ªè nh·ªØng nƒÉng l∆∞·ª£ng ti√™u c·ª±c. NƒÉm m·ªõi, b·∫°n s·∫Ω nh·∫π nh√†ng h∆°n, vui v·∫ª h∆°n v√† 'b·∫•t kh·∫£ x√¢m ph·∫°m' tr∆∞·ªõc nh·ªØng l·ªùi ƒë√†m ti·∫øu." },
            { id: 4, wish: "TRACK 04: D√ÅM L√ÄM NH·ªÆNG ƒêI·ªÄU CH∆ØA T·ª™NG D√ÅM.", song: "The Nights - Avicii", file: "track4.mp3", color: "#4B0082", analysis: "C√≥ nh·ªØng gi·∫•c m∆° b·∫°n ƒë√£ ·∫•p ·ªß qu√° l√¢u. ƒê√¢y l√† t√≠n hi·ªáu: 'B√¢y gi·ªù ho·∫∑c kh√¥ng bao gi·ªù'. NƒÉm 2026, h√£y ƒëi con ƒë∆∞·ªùng b·∫°n s·ª£ h√£i, v√¨ ƒë√≥ l√† n∆°i kho b√°u ƒëang ch·ªù ƒë·ª£i." },
            { id: 5, wish: "TRACK 05: T·ªéA S√ÅNG THEO C√ÅCH RI√äNG C·ª¶A B·∫†N.", song: "Diamonds - Rihanna", file: "track5.mp3", color: "#C0C0C0", analysis: "√Åp l·ª±c t·∫°o n√™n kim c∆∞∆°ng. Nh·ªØng th·ª≠ th√°ch v·ª´a qua ch·ªâ ƒëang m√†i gi≈©a b·∫°n s√°ng h∆°n m√† th√¥i. ƒê·ª´ng ng·∫°i kh√°c bi·ªát, v√¨ s·ª± ƒë·ªôc b·∫£n c·ªßa b·∫°n ch√≠nh l√† th·ª© ƒë·∫Øt gi√° nh·∫•t." },
            { id: 6, wish: "TRACK 06: T√åM TH·∫§Y K·∫æT N·ªêI CH√ÇN TH·∫¨T NH·∫§T.", song: "Until I Found You", file: "track6.mp3", color: "#DC143C", analysis: "B·∫°n ƒëang ·ªü t·∫ßn s·ªë c·ªßa t√¨nh y√™u v√† s·ª± k·∫øt n·ªëi s√¢u s·∫Øc. C√≥ th·ªÉ l√† m·ªôt tri k·ª∑, m·ªôt ng∆∞·ªùi b·∫°n t√¢m giao, ho·∫∑c ƒë∆°n gi·∫£n l√† t√¨m l·∫°i s·ª± k·∫øt n·ªëi v·ªõi ch√≠nh b·∫£n th√¢n m√¨nh. H√£y m·ªü l√≤ng." },
            { id: 7, wish: "CH√öC M·ª™NG! B·∫†N ƒê√É TR√öNG VOUCHER 20K", song: "Money - Lisa", file: "track7.mp3", color: "#006400", analysis: "Th·∫ßn t√†i g√µ c·ª≠a! S·ª± may m·∫Øn v·ªÅ t√†i ch√≠nh v√† c√¥ng vi·ªác ƒëang h∆∞·ªõng v·ªÅ ph√≠a b·∫°n. ƒê∆∞a m√†n h√¨nh n√†y cho nh√¢n vi√™n ƒë·ªÉ nh·∫≠n ∆∞u ƒë√£i nh√©!" },
            { id: 8, wish: "TRACK 08: B·∫¢N NH·∫†C HAY NH·∫§T ƒê·ªúI B·∫†N.", song: "Best Day Of My Life", file: "track8.mp3", color: "#87CEEB", analysis: "NƒÉng l∆∞·ª£ng t√≠ch c·ª±c c·ª±c ƒë·∫°i! B·∫°n ƒëang thu h√∫t nh·ªØng ng√†y tuy·ªát v·ªùi ph√≠a tr∆∞·ªõc. H√£y th·ª©c d·∫≠y m·ªói ng√†y v·ªõi suy nghƒ© r·∫±ng ƒëi·ªÅu k·ª≥ di·ªáu s·∫Øp x·∫£y ra, v√† n√≥ s·∫Ω ƒë·∫øn." },
            { id: 9, wish: "TRACK 09: Y√äU B·∫¢N TH√ÇN NHI·ªÄU H∆†N M·ªòT CH√öT.", song: "Flowers - Miley Cyrus", file: "track9.mp3", color: "#960018", analysis: "ƒê·ªôc l·∫≠p, t·ª± do v√† ki√™u h√£nh. T·∫ßn s·ªë n√†y nh·∫Øc b·∫°n r·∫±ng kh√¥ng ai c√≥ th·ªÉ y√™u th∆∞∆°ng b·∫°n t·ªët h∆°n ch√≠nh b·∫°n. H√£y t·ª± mua hoa cho m√¨nh, t·ª± t·∫°o ni·ªÅm vui cho m√¨nh." },
            { id: 10, wish: "TRACK 10: CH·ªÆA L√ÄNH NH·ªÆNG T·ªîN TH∆Ø∆†NG.", song: "Heal The World - MJ", file: "track10.mp3", color: "#2E8B57", analysis: "M·ªôt tr√°i tim ·∫•m √°p l√† li·ªÅu thu·ªëc t·ªët nh·∫•t. NƒÉm 2026, h√£y d√†nh th·ªùi gian chƒÉm s√≥c s·ª©c kh·ªèe tinh th·∫ßn c·ªßa m√¨nh v√† lan t·ªèa s·ª± t·ª≠ t·∫ø. Th·∫ø gi·ªõi c·ªßa b·∫°n s·∫Ω tr·ªü n√™n d·ªãu d√†ng h∆°n bao gi·ªù h·∫øt." },
            { id: 11, wish: "TRACK 11: B·ª®T PH√Å M·ªåI GI·ªöI H·∫†N.", song: "Unstoppable - Sia", file: "track11.mp3", color: "#FF4500", analysis: "B·∫°n ƒëang s·ªü h·ªØu m·ªôt ngu·ªìn nƒÉng l∆∞·ª£ng ti·ªÅm ·∫©n c·ª±c l·ªõn. ƒê·ª´ng ƒë·ªÉ b·∫•t k·ª≥ ai n√≥i r·∫±ng b·∫°n kh√¥ng th·ªÉ. H√£y gi·ªØ v·ªØng ni·ªÅm tin, ƒë·∫°p ƒë·ªï m·ªçi r√†o c·∫£n v√† ch·ª©ng minh cho c·∫£ th·∫ø gi·ªõi th·∫•y b·∫£n lƒ©nh c·ªßa b·∫°n." },
            { id: 12, wish: "TRACK 12: M·ªåI CHUY·ªÜN R·ªíI S·∫º ·ªîN TH√îI.", song: "Three Little Birds - Bob Marley", file: "track12.mp3", color: "#3CB371", analysis: "'Don't worry about a thing...' - V≈© tr·ª• mu·ªën nh·∫Øn nh·ªß b·∫°n r·∫±ng ƒë·ª´ng qu√° lo l·∫Øng v·ªÅ t∆∞∆°ng lai. H√£y th·∫£ l·ªèng, tin t∆∞·ªüng v√†o d√≤ng ch·∫£y cu·ªôc ƒë·ªùi. M·ªçi kh√≥ khƒÉn hi·ªán t·∫°i ch·ªâ l√† t·∫°m th·ªùi, v√† b√¨nh minh r·ª±c r·ª° ƒëang ch·ªù ƒë√≥n b·∫°n." },
            { id: 13, wish: "TRACK 13: S·ªêNG KH√îNG H·ªêI TI·∫æC & CH√ÅY H·∫æT M√åNH.", song: "Counting Stars - OneRepublic", file: "track13.mp3", color: "#800080", analysis: "ƒê·ª´ng ch·ªâ ng·ªìi ƒë√≥ v√† ƒë·∫øm sao, h√£y v∆∞∆°n tay h√°i l·∫•y ch√∫ng. T·∫ßn s·ªë n√†y b√°o hi·ªáu m·ªôt nƒÉm b·∫°n s·∫Ω d√°m nghƒ©, d√°m l√†m v√† d√°m theo ƒëu·ªïi ƒëam m√™ ƒë·∫øn c√πng. Ti·ªÅn b·∫°c s·∫Ω t·ª± ƒë·∫øn khi b·∫°n l√†m ƒëi·ªÅu m√¨nh y√™u." },
            { id: 14, wish: "TRACK 14: T√åM TH·∫§Y ƒê·ªíNG ƒê·ªòI & S·ª∞ H·∫¨U THU·∫™N.", song: "Count On Me - Bruno Mars", file: "track14.mp3", color: "#FF7F50", analysis: "B·∫°n kh√¥ng c·∫ßn ph·∫£i g·ªìng g√°nh c·∫£ th·∫ø gi·ªõi m·ªôt m√¨nh. NƒÉm nay, nh·ªØng ng∆∞·ªùi b·∫°n ch√¢n th√†nh, nh·ªØng ƒë·ªëi t√°c tin c·∫≠y s·∫Ω xu·∫•t hi·ªán ƒë·ªÉ s√°t c√°nh c√πng b·∫°n. H√£y tr√¢n tr·ªçng nh·ªØng m·ªëi quan h·ªá ch·∫•t l∆∞·ª£ng." },
            { id: 15, wish: "TRACK 15: GHI T√äN M√åNH L√äN B·∫¢NG V√ÄNG.", song: "Hall of Fame - The Script", file: "track15.mp3", color: "#B8860B", analysis: "Vinh quang ƒëang ch·ªù ƒë·ª£i ·ªü ph√≠a cu·ªëi con ƒë∆∞·ªùng. M·ªçi n·ªó l·ª±c b·ªÅn b·ªâ c·ªßa b·∫°n s·∫Ω ƒë∆∞·ª£c ƒë·ªÅn ƒë√°p x·ª©ng ƒë√°ng. H√£y ki√™n tr√¨, v√¨ b·∫°n sinh ra l√† ƒë·ªÉ tr·ªü th√†nh m·ªôt nh√† v√¥ ƒë·ªãch trong lƒ©nh v·ª±c c·ªßa m√¨nh." }
        ];

        // --- VARIABLES ---
        const audio = document.getElementById('bgMusic');
        const record = document.getElementById('record');
        const label = document.getElementById('label');
        const displayText = document.getElementById('display-text');
        const metaText = document.getElementById('meta-text');
        const progressFill = document.getElementById('progressFill');
        const currentTimeEl = document.getElementById('currentTime');
        const totalTimeEl = document.getElementById('totalTime');
        const analysisSection = document.getElementById('analysisSection');
        const analysisTitle = document.getElementById('analysisTitle');
        const analysisContent = document.getElementById('analysisContent');
        const preloader = document.getElementById('preloader');
        
        // Voucher Elements
        const voucherOverlay = document.getElementById('voucher-overlay');
        const liveClockEl = document.getElementById('liveClock');
        const securityCodeEl = document.getElementById('securityCode');
        const voucherValueEl = document.getElementById('voucherValue');
        const staffBtnEl = document.getElementById('staffBtn');

        // Share Elements
        const shareOverlay = document.getElementById('share-overlay');
        const shareNameInput = document.getElementById('shareNameInput');

        const STORAGE_KEY = '_ga_playlist_idx';
        const SPIN_COUNT_KEY = '_ga_session_ck';
        const VOUCHER_USED_KEY = '_ga_promo_status';

        let isPlaying = false;
        let userTrack = null;

        // --- INITIALIZATION ---
        window.onload = function() {
            preloader.style.opacity = '0';
            setTimeout(() => { preloader.style.display = 'none'; }, 500);
            
            const savedIndex = localStorage.getItem(STORAGE_KEY);
            if (savedIndex !== null) {
                userTrack = tracks[parseInt(savedIndex)];
                finalizeUI(userTrack);
            }
        };

        // --- COUNTDOWN & HNY LOGIC ---
        const targetDate = new Date('January 1, 2026 00:00:00').getTime();
        
        function updateCountdown() {
            const now = new Date().getTime();
            const gap = targetDate - now;

            if (gap < 0) {
                // HAPPY NEW YEAR MODE
                document.getElementById('countdown').style.display = 'none';
                document.getElementById('hny-text').style.display = 'block';
                // Trigger fireworks loop if not already running
                if (!window.hnyFireworks) {
                    window.hnyFireworks = true;
                    var duration = 15 * 1000;
                    var animationEnd = Date.now() + duration;
                    var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };
                    var interval = setInterval(function() {
                        var timeLeft = animationEnd - Date.now();
                        if (timeLeft <= 0) { return clearInterval(interval); }
                        var particleCount = 50 * (timeLeft / duration);
                        confetti(Object.assign({}, defaults, { particleCount, origin: { x: Math.random(), y: Math.random() - 0.2 } }));
                    }, 250);
                }
            } else {
                // COUNTDOWN MODE
                const d = Math.floor(gap / (1000 * 60 * 60 * 24));
                const h = Math.floor((gap % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((gap % (1000 * 60 * 60)) / (1000 * 60));
                const s = Math.floor((gap % (1000 * 60)) / 1000);
                document.getElementById('countdown').innerText = (d < 10 ? "0"+d : d) + ":" + (h < 10 ? "0"+h : h) + ":" + (m < 10 ? "0"+m : m) + ":" + (s < 10 ? "0"+s : s);
            }
        }
        setInterval(updateCountdown, 1000);
        updateCountdown();

        // --- EASTER EGG (GHOST TRACK & INVERT) ---
        let logoClicks = 0;
        let secretMode = false;
        const logoImg = document.getElementById('logoClick');
        
        logoImg.onclick = function() {
            logoClicks++;
            if (logoClicks === 5) {
                activateSecretMode();
            }
            if (window.clickTimer) clearTimeout(window.clickTimer);
            window.clickTimer = setTimeout(() => { logoClicks = 0; }, 2000);
        };

        function activateSecretMode() {
            secretMode = true;
            logoClicks = 0;
            
            // INVERT COLORS
            document.body.classList.add('invert-mode');
            
            showToast("üîì SECRET MODE UNLOCKED!");
            
            const secretTrack = { 
                id: 999, 
                wish: "SECRET TRACK: NIGHTCALL.", 
                song: "Nightcall - Kavinsky", 
                file: "secret.mp3", 
                color: "#ff00ff", // Neon pink for secret
                analysis: "B√≥ng t·ªëi bao tr√πm, ch·ªâ c√≤n l·∫°i √°nh ƒë√®n neon v√† ti·∫øng ƒë·ªông c∆° xe. Ch√∫c m·ª´ng b·∫°n ƒë√£ t√¨m th·∫•y b·∫£n nh·∫°c c·ªßa m√†n ƒë√™m." 
            };
            
            userTrack = secretTrack;
            finalizeUI(userTrack);
            
            if(!isPlaying) playMusic();
            else {
                audio.src = userTrack.file;
                audio.play();
                setTrackInfo(userTrack);
            }
        }

        // --- PLAYER LOGIC ---
        function handleInteraction() { if (isPlaying) { pauseMusic(); } else { playMusic(); } }

        function playMusic() {
            record.classList.add('spinning-anim');
            label.classList.add('spinning-anim');
            isPlaying = true;
            if (userTrack) {
                audio.src = userTrack.file;
                audio.play();
                document.querySelector('.player-controls').parentElement.classList.add('has-played');
                
                // Hi·ªán th∆∞ c·∫£m ∆°n
                document.querySelector('.screen-letter').style.display = 'block';

                if(userTrack.id === 7) {
                    updateVoucherUI();
                    voucherOverlay.style.display = 'flex';
                }
            } else {
                startShuffle();
            }
        }

        function pauseMusic() {
            audio.pause();
            record.classList.remove('spinning-anim');
            label.classList.remove('spinning-anim');
            isPlaying = false;
        }

        function startShuffle() {
            // T·∫Øt secret mode n·∫øu ƒëang b·∫≠t ƒë·ªÉ v·ªÅ b√¨nh th∆∞·ªùng
            if(secretMode) {
                secretMode = false;
                document.body.classList.remove('invert-mode');
            }
            
            displayText.classList.remove('breathing');
            metaText.innerText = "SCANNING FREQUENCY...";
            label.style.backgroundColor = '#f0f0f0'; 
            let count = 0; let speed = 50; let maxCount = 40;
            const randomPool = tracks.filter(t => t.id !== 7);
            
            function step() {
                const randomItem = randomPool[Math.floor(Math.random() * randomPool.length)];
                displayText.innerText = randomItem.wish;
                displayText.style.opacity = 0.6;
                count++;
                if (count < maxCount) {
                    speed += (count > 30) ? 15 : 2;
                    setTimeout(step, speed);
                } else {
                    finalizeResult();
                }
            }
            step();
        }

        function finalizeResult() {
            let spinCount = parseInt(localStorage.getItem(SPIN_COUNT_KEY)) || 0;
            spinCount++;
            localStorage.setItem(SPIN_COUNT_KEY, spinCount);

            let selectedTrack;
            if (spinCount > 0 && spinCount % 26 === 0) {
                selectedTrack = tracks.find(t => t.id === 7); 
            } else {
                const normalTracks = tracks.filter(t => t.id !== 7);
                selectedTrack = normalTracks[Math.floor(Math.random() * normalTracks.length)];
            }

            const originalIndex = tracks.indexOf(selectedTrack);
            userTrack = selectedTrack;
            localStorage.setItem(STORAGE_KEY, originalIndex);
            
            audio.src = userTrack.file;
            audio.play().catch(e => console.log("Interaction needed"));
            if (navigator.vibrate) navigator.vibrate([50, 30, 50]);
            
            record.classList.add('spinning-anim');
            label.classList.add('spinning-anim');
            isPlaying = true;

            finalizeUI(userTrack);
        }

        function finalizeUI(track) {
            setTrackInfo(track);
            displayText.style.opacity = 1;
            displayText.classList.add('glitch');
            document.querySelector('.player-controls').parentElement.classList.add('has-played');
            label.style.backgroundColor = track.color;
            
            analysisSection.style.display = 'block';
            analysisTitle.innerText = "Why this track?";
            analysisContent.innerText = track.analysis;
            
            // HI·ªÜN L·ªúI C·∫¢M ∆†N SAU KHI C√ì K·∫æT QU·∫¢
            document.querySelector('.screen-letter').style.display = 'block';

            if (track.id === 7) {
                updateVoucherUI();
                voucherOverlay.style.display = 'flex';
            }
        }

        // --- VOUCHER LOGIC ---
        function updateLiveClock() {
            const now = new Date();
            liveClockEl.innerHTML = '<span class="live-dot"></span>' + now.toLocaleTimeString();
        }
        setInterval(updateLiveClock, 1000);

        function updateVoucherUI() {
            const isUsed = localStorage.getItem(VOUCHER_USED_KEY) === 'true';
            let secCode = localStorage.getItem('_ga_sec_code');
            if (!secCode) {
                secCode = '#' + Math.random().toString(36).substr(2, 4).toUpperCase();
                localStorage.setItem('_ga_sec_code', secCode);
            }
            securityCodeEl.innerText = secCode;

            if (isUsed) {
                voucherValueEl.innerText = "ƒê√É S·ª¨ D·ª§NG";
                voucherValueEl.classList.add('used');
                staffBtnEl.innerText = "VOUCHER ƒê√É H·ª¶Y";
                staffBtnEl.classList.add('disabled');
                if (window.confettiInterval) clearInterval(window.confettiInterval);
            } else {
                voucherValueEl.innerText = "-20K";
                voucherValueEl.classList.remove('used');
                staffBtnEl.innerText = "NH√ÇN VI√äN X√ÅC NH·∫¨N";
                staffBtnEl.classList.remove('disabled');
                
                var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 3000 };
                if (window.confettiInterval) clearInterval(window.confettiInterval);
                window.confettiInterval = setInterval(function() {
                    confetti(Object.assign({}, defaults, { particleCount: 30, origin: { x: Math.random(), y: Math.random() - 0.2 } }));
                }, 400);
            }
        }

        function staffConfirm() {
            let pass = prompt("Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u qu·∫£n l√Ω:");
            if (pass === "photonoir@") {
                if (confirm("X√°c nh·∫≠n: Kh√°ch h√†ng ƒëang s·ª≠ d·ª•ng Voucher n√†y?")) {
                    localStorage.setItem(VOUCHER_USED_KEY, 'true');
                    updateVoucherUI();
                    alert("ƒê√£ x√°c nh·∫≠n s·ª≠ d·ª•ng th√†nh c√¥ng!");
                }
            } else if (pass !== null) {
                alert("M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!");
            }
        }

        // --- SHARE LOGIC ---
        function openShareOverlay() {
            if (!userTrack) return;
            
            // Fill Data to Share Card
            document.getElementById('realShareSong').innerText = userTrack.song;
            // Quote ng·∫Øn
            document.getElementById('realShareQuote').innerText = '"' + userTrack.wish.split(':')[1].trim() + '"';
            // N·ªôi dung ph√¢n t√≠ch ƒë·∫ßy ƒë·ªß
            document.getElementById('realShareAnalysis').innerText = userTrack.analysis;
            
            document.getElementById('realShareLabel').style.backgroundColor = userTrack.color;
            
            // Hi·ªÉn th·ªã Overlay Share
            shareOverlay.style.display = 'flex';
        }

        function updateSignature(val) {
            const display = document.getElementById('signatureDisplay');
            display.innerText = val ? val : "Guest";
        }

        function downloadElement(elementId, fileName) {
            const element = document.getElementById(elementId);
            
            // X·ª≠ l√Ω t·∫°m th·ªùi ƒë·ªÉ ch·ª•p ƒë·∫πp (·∫©n nh·∫•p nh√°y n·∫øu c√≥)
            let originalTime = "";
            if(elementId === 'voucher-ticket') {
                originalTime = liveClockEl.innerHTML;
                liveClockEl.innerHTML = originalTime.replace('<span class="live-dot"></span>', '');
            }

            html2canvas(element, { backgroundColor: null, scale: 2, useCORS: true }).then(canvas => {
                const link = document.createElement('a');
                link.download = fileName + '.png';
                link.href = canvas.toDataURL("image/png");
                link.click();
                
                if(elementId === 'voucher-ticket') liveClockEl.innerHTML = originalTime;
                showToast("ƒê√£ l∆∞u ·∫£nh v√†o th∆∞ vi·ªán!");
            });
        }

        function nativeShare() {
            const text = `T·∫ßn s·ªë 2026 c·ªßa t√¥i: "${userTrack.song}". Xem th√¥ng ƒëi·ªáp t·∫°i: ${window.location.href}`;
            if (navigator.share) {
                navigator.share({ title: 'PHOTONOIR - 2026', text: text, url: window.location.href, }).catch(console.error);
            } else {
                navigator.clipboard.writeText(text).then(() => { showToast("ƒê√£ copy link! H√£y d√°n v√†o tin nh·∫Øn."); });
            }
        }

        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        // --- UTILS ---
        function setTrackInfo(track) { displayText.innerText = track.wish; metaText.innerText = "NOW PLAYING: " + track.song; }
        function scrollToNext() { document.getElementById('scrollHint').scrollIntoView({ behavior: 'smooth' }); }
        
        function showToast(msg) {
            var x = document.getElementById("toast");
            x.innerText = msg;
            x.className = "show";
            setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
        }

        window.addEventListener('scroll', () => {
            if (!isPlaying) return;
            const letterTop = document.querySelector('.screen-letter').getBoundingClientRect().top;
            const windowHeight = window.innerHeight;
            if (letterTop < windowHeight * 0.8) { if (audio.volume > 0.2) audio.volume -= 0.05; } else { if (audio.volume < 1.0) audio.volume += 0.05; }
        });

        audio.ontimeupdate = function() {
            if (audio.duration) {
                const percent = (audio.currentTime / audio.duration) * 100;
                progressFill.style.width = percent + '%';
                currentTimeEl.innerText = formatTime(audio.currentTime);
                totalTimeEl.innerText = formatTime(audio.duration);
            }
        };

        audio.onended = function() {
            record.classList.remove('spinning-anim');
            label.classList.remove('spinning-anim');
            isPlaying = false;
            progressFill.style.width = '0%';
        };

        function formatTime(s) {
            if(isNaN(s)) return "0:00";
            const min = Math.floor(s / 60);
            const sec = Math.floor(s % 60);
            return `${min}:${sec<10?'0'+sec:sec}`;
        }
    </script>
</body>
</html>
